{{ define "main" }}

{{ .Content }}

<div class="container">
  <p class="message">正在為您挑選隨機文章，請稍候...</p>
</div>

<script>
  (function() {
    // 取得所有一般文章網址
    const posts = [
      {{ range .Site.RegularPages }}
        "{{ .Permalink }}",
      {{ end }}
    ];

    // 過濾掉目前的頁面，避免無限循環（如果隨機頁面本身也被歸類在 RegularPages）
    const currentUrl = window.location.href;
    const filteredPosts = posts.filter(url => !currentUrl.includes(url) && url !== "");

    if (filteredPosts.length === 0) {
      document.querySelector('.message').textContent = '目前沒有可跳轉的文章。';
      return;
    }

    // 隨機選取一個網址
    const randomIndex = Math.floor(Math.random() * filteredPosts.length);
    const randomPost = filteredPosts[randomIndex];

    // 執行立即跳轉
    window.location.replace(randomPost);
  })();
</script>

<style>
  .container {
    text-align: center;
    padding: 50px 20px;
  }
  .message {
    font-size: 1.2rem;
    color: var(--secondary);
  }
</style>

{{ end }}